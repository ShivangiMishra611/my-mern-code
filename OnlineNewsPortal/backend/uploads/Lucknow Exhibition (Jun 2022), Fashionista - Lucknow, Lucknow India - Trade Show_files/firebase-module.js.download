const cat2event={3:{id:715842,name:"Apparel & Clothing",url:"event/715842",floor:"https://apparel.floor.bz/cast/login"},5:{id:715844,name:"Auto & Automotive",url:"event/715844",floor:"https://automobile.floor.bz/cast/login"},7:{id:715845,name:"Building & Construction",url:"event/715845",floor:"https://construction.floor.bz/cast/login"},13:{id:715848,name:"Electric & Electronics",url:"event/715848",floor:"https://electric.floor.bz/cast/login"},16:{id:715849,name:"Agriculture & Forestry",url:"event/715849",floor:"https://agriculture.floor.bz/cast/login"},19:{id:715850,name:"Arts & Crafts",url:"event/715850",floor:"https://artcrafts.floor.bz/cast/login"},27:{id:715854,name:"Medical & Pharma",url:"event/715854",floor:"https://health.floor.bz/cast/login"},30:{id:715855,name:"Packing & Packaging\t",url:"event/715855",floor:"https://packaging.floor.bz/cast/login"},34:{id:715856,name:"Industrial Engineering",url:"event/715856",floor:"https://engineering.floor.bz/cast/login"},37:{id:715859,name:"Telecommunication",url:"event/715859",floor:"https://telecom.floor.bz/cast/login"},50:{id:715860,name:"Travel & Tourism",url:"event/715860",floor:"https://travel.floor.bz/cast/login"},53:{id:715862,name:"Science & Research",url:"event/715862",floor:"https://science.floor.bz/cast/login"},55:{id:715863,name:"Business Services",url:"event/715863",floor:"https://services.floor.bz/cast/login"},61:{id:715866,name:"Education & Training",url:"event/715866",floor:"https://teaching.floor.bz/cast/login"},80:{id:715864,name:"Logistics & Transportation",url:"event/715864",floor:"https://logistics.floor.bz/cast/login"},106:{id:715867,name:"Environment & Waste",url:"event/715867",floor:"https://environment.floor.bz/cast/login"},107:{id:715869,name:"Fashion & Beauty",url:"event/715869",floor:"https://lifestyle.floor.bz/cast/login"},108:{id:715871,name:"Food & Beverages",url:"event/715871",floor:"https://cuisine.floor.bz/cast/login"},113:{id:715876,name:"Baby, Kids & Maternity",url:"event/715876",floor:"https://children.floor.bz/cast/login"},125:{id:715874,name:"Wellness, Health & Fitness",url:"event/715874",floor:"https://wellness.floor.bz/cast/login"},128:{id:715877,name:"Power & Energy",url:"event/715877",floor:"https://energy.floor.bz/cast/login"},146:{id:715879,name:"Banking & Finance",url:"event/715879",floor:"https://investment.floor.bz/cast/login"},150:{id:715878,name:"Security & Defense",url:"event/715878",floor:"https://security.floor.bz/cast/login"},156:{id:715883,name:"IT & Technology",url:"event/715883",floor:"https://computing.floor.bz/cast/login"},158:{id:715880,name:"Animals & Pets\t",url:"event/715880",floor:"https://animals.floor.bz/cast/login"},159:{id:715881,name:"Home & Office",url:"event/715881",floor:"https://office.floor.bz/cast/login"},160:{id:715882,name:"Hospitality",url:"event/715882",floor:"https://hospitality.floor.bz/cast/login"},161:{id:715884,name:"Entertainment & Media",url:"event/715884",floor:"https://entertainment.floor.bz/cast/login"}},initFirebase=async e=>{"undefined"==typeof firebase&&(await loadScript("https://www.gstatic.com/firebasejs/9.8.1/firebase-app-compat.js"),await loadScript("https://www.gstatic.com/firebasejs/9.8.1/firebase-auth-compat.js"),await loadScript("https://www.gstatic.com/firebasejs/9.8.1/firebase-messaging-compat.js"),await loadScript("https://www.gstatic.com/firebasejs/9.8.1/firebase-firestore-compat.js"),await loadScript("https://www.gstatic.com/firebasejs/9.8.1/firebase-database-compat.js"),firebase.initializeApp({apiKey:"AIzaSyBaCZhOXaPMLi4BY4qIKcRcbZ0EIeQlA_U",authDomain:"times-pn.firebaseapp.com",databaseURL:"https://times-pn-default-rtdb.firebaseio.com",projectId:"times-pn",storageBucket:"times-pn.appspot.com",messagingSenderId:"883369105203",appId:"1:883369105203:web:a8e6c99f185ddd7c325046",measurementId:"G-CMMTK2CGFK"}),firebase.firestore().settings({experimentalAutoDetectLongPolling:!0,useFetchStreams:!1,ignoreUndefinedProperties:!0,ssl:!0,merge:!0}),await firebase.firestore().enableNetwork(),await firebase.auth().signInAnonymously(),user.gaId=getCookie("_ga").replace(/GA1.1.|GA1.2.|\./i,"").replace(/\D/i,""),user.fireId=firebase.auth().currentUser.uid),handleCallback({callback:e})},addCurrentUser=e=>{let t="bg-danger";e.online&&(e.active?(t="bg-success",e.idle&&(t="bg-orange-l")):t="bg-secondary");let a=`\n    <div class="d-flex justify-content-between mb-3">\n      <div id="current-user-active-container" class="form-check form-switch">\n        <label class="form-check-label" for="current-user-active">\n          Available\n        </label>\n\n        <input id="current-user-active" class="form-check-input" type="checkbox" role="switch" ${e.active?"checked":""} />\n      </div>\n\n      <button id="call-view-close" class="btn btn-sm fw-normal rounded-circle text-white p-0 c-ga" data-bs-toggle="collapse" data-bs-target="#call-view" data-ga-category="Community Listing" data-ga-action="Call Bubble Close" data-ga-label="Event Listing" aria-expanded="true" aria-controls="#call-view">\n        Close\n      </button>\n    </div>\n\n    <div class="d-flex justify-content-between align-items-end">\n      <div class="d-flex align-items-center">\n        <div class="position-relative me-3">\n          <img class="rounded-circle" src=${e.userImage} width="30" height="30" />\n\n          <span class="position-absolute d-inline-block top-0 right-0 ${t} rounded-circle" style="width: 7px; height: 7px;">\n          </span>\n        </div>\n\n        <div class="d-flex flex-column justify-content-between">\n          <div class="fw-bold">\n            ${e.userName&&"Anonymous"!=e.userName?"Hi, "+e.userName:"Hi,"}\n          </div>\n  `;return(e.userCity||e.userCountry)&&(a+='<div class="small location">',e.userCountry?(e.userCity&&(a+=`${e.userCity}, `),a+=e.userCountry):e.userCity&&(a+=e.userCity),a+="</div>"),(e.userDesignation||e.userComapny)&&(a+='<div class="small profession">',e.userComapny?(e.userDesignation&&(a+=`${e.userDesignation} at `),a+=e.userComapny):e.userDesignation&&(a+=e.userDesignation),a+="</div>"),a+="\n      </div>\n    </div>\n  ",e.onCall?(a+='\n      <div class="d-flex flex-column align-items-end">\n    ',(e.receiver||e.sender)&&(a+='\n        <div class="d-flex justify-content-between align-items-center gap-4">\n          <button id="join-live-call" class="btn btn-sm text-white bg-success rounded-circle c-ga xn" data-ga-category="Community Listing" data-ga-action="Call Join Click" data-ga-label="Event Listing" style="width: max-content; padding: 0px 5px;">\n            <span data-bs-toggle="tooltip" title="Join ongoing call" data-tooltip-check="true">\n              <svg class="svg-inline--fa fa-phone-alt fa-w-16 fa-sm" aria-hidden="true" focusable="false" data-prefix="fas" data-icon="phone-alt" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" data-fa-i2svg=""><path fill="currentColor" d="M497.39 361.8l-112-48a24 24 0 0 0-28 6.9l-49.6 60.6A370.66 370.66 0 0 1 130.6 204.11l60.6-49.6a23.94 23.94 0 0 0 6.9-28l-48-112A24.16 24.16 0 0 0 122.6.61l-104 24A24 24 0 0 0 0 48c0 256.5 207.9 464 464 464a24 24 0 0 0 23.4-18.6l24-104a24.29 24.29 0 0 0-14.01-27.6z"></path></svg>\n            </span>\n          </button>\n      '),a+='\n        <button id="abort-live-call" class="btn btn-sm text-danger bg-light rounded-circle c-ga xn"  data-ga-category="Community Listing" data-ga-action="Call Ignore Click" data-ga-label="Event Listing" style="width: max-content; padding: 0px 4px;">\n          <span data-bs-toggle="tooltip" title="Disconnect ongoing call" data-tooltip-check="true">\n            <svg class="svg-inline--fa fa-phone-slash fa-w-20 fa-xs" aria-hidden="true" focusable="false" data-prefix="fas" data-icon="phone-slash" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512" data-fa-i2svg=""><path fill="currentColor" d="M268.2 381.4l-49.6-60.6c-6.8-8.3-18.2-11.1-28-6.9l-112 48c-10.7 4.6-16.5 16.1-13.9 27.5l24 104c2.5 10.8 12.1 18.6 23.4 18.6 100.7 0 193.7-32.4 269.7-86.9l-80-61.8c-10.9 6.5-22.1 12.7-33.6 18.1zm365.6 76.7L475.1 335.5C537.9 256.4 576 156.9 576 48c0-11.2-7.7-20.9-18.6-23.4l-104-24c-11.3-2.6-22.9 3.3-27.5 13.9l-48 112c-4.2 9.8-1.4 21.3 6.9 28l60.6 49.6c-12.2 26.1-27.9 50.3-46 72.8L45.5 3.4C38.5-2 28.5-.8 23 6.2L3.4 31.4c-5.4 7-4.2 17 2.8 22.4l588.4 454.7c7 5.4 17 4.2 22.5-2.8l19.6-25.3c5.4-6.8 4.1-16.9-2.9-22.3z"></path></svg>\n          </span>\n        </button>\n    ',(e.receiver||e.sender)&&(a+="\n        </div>\n      "),e.receiver||e.sender||(a+='\n        <style>.dot-flashing{width:3px;height:3px;border-radius:5px;background-color:#9880ff;color:#9880ff;animation:dotFlashing 1s infinite linear alternate;animation-delay:.5s}.dot-flashing::after,.dot-flashing::before{content:\'\';display:inline-block;position:absolute;top:0}.dot-flashing::before{left:-6px;width:3px;height:3px;border-radius:5px;background-color:#9880ff;color:#9880ff;animation:dotFlashing 1s infinite alternate;animation-delay:0s}.dot-flashing::after{left:6px;width:3px;height:3px;border-radius:5px;background-color:#9880ff;color:#9880ff;animation:dotFlashing 1s infinite alternate;animation-delay:1s}@keyframes dotFlashing{0%{background-color:#9880ff}100%,50%{background-color:#ebe6ff}}</style>\n\n        <div class="d-flex align-items-center">\n          <small class="me-2">\n            Connecting\n          </small>\n\n          <span class="position-relative text-white dot-flashing mt-1">\n          </span>\n        </div>\n      '),a+="\n      </div>\n    "):getCookie("user")&&getCookie("user_token")&&(a+='\n      <a class="btn btn-sm text-white c-ga" href="/dashboard/edit" data-ga-category="Community Listing" data-ga-action="Call Settings" data-ga-label="Event Listing" target="_blank">\n        <svg class="svg-inline--fa fa-cog fa-w-16" aria-hidden="true" focusable="false" data-prefix="far" data-icon="cog" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" data-fa-i2svg=""><path fill="currentColor" d="M452.515 237l31.843-18.382c9.426-5.441 13.996-16.542 11.177-27.054-11.404-42.531-33.842-80.547-64.058-110.797-7.68-7.688-19.575-9.246-28.985-3.811l-31.785 18.358a196.276 196.276 0 0 0-32.899-19.02V39.541a24.016 24.016 0 0 0-17.842-23.206c-41.761-11.107-86.117-11.121-127.93-.001-10.519 2.798-17.844 12.321-17.844 23.206v36.753a196.276 196.276 0 0 0-32.899 19.02l-31.785-18.358c-9.41-5.435-21.305-3.877-28.985 3.811-30.216 30.25-52.654 68.265-64.058 110.797-2.819 10.512 1.751 21.613 11.177 27.054L59.485 237a197.715 197.715 0 0 0 0 37.999l-31.843 18.382c-9.426 5.441-13.996 16.542-11.177 27.054 11.404 42.531 33.842 80.547 64.058 110.797 7.68 7.688 19.575 9.246 28.985 3.811l31.785-18.358a196.202 196.202 0 0 0 32.899 19.019v36.753a24.016 24.016 0 0 0 17.842 23.206c41.761 11.107 86.117 11.122 127.93.001 10.519-2.798 17.844-12.321 17.844-23.206v-36.753a196.34 196.34 0 0 0 32.899-19.019l31.785 18.358c9.41 5.435 21.305 3.877 28.985-3.811 30.216-30.25 52.654-68.266 64.058-110.797 2.819-10.512-1.751-21.613-11.177-27.054L452.515 275c1.22-12.65 1.22-25.35 0-38zm-52.679 63.019l43.819 25.289a200.138 200.138 0 0 1-33.849 58.528l-43.829-25.309c-31.984 27.397-36.659 30.077-76.168 44.029v50.599a200.917 200.917 0 0 1-67.618 0v-50.599c-39.504-13.95-44.196-16.642-76.168-44.029l-43.829 25.309a200.15 200.15 0 0 1-33.849-58.528l43.819-25.289c-7.63-41.299-7.634-46.719 0-88.038l-43.819-25.289c7.85-21.229 19.31-41.049 33.849-58.529l43.829 25.309c31.984-27.397 36.66-30.078 76.168-44.029V58.845a200.917 200.917 0 0 1 67.618 0v50.599c39.504 13.95 44.196 16.642 76.168 44.029l43.829-25.309a200.143 200.143 0 0 1 33.849 58.529l-43.819 25.289c7.631 41.3 7.634 46.718 0 88.037zM256 160c-52.935 0-96 43.065-96 96s43.065 96 96 96 96-43.065 96-96-43.065-96-96-96zm0 144c-26.468 0-48-21.532-48-48 0-26.467 21.532-48 48-48s48 21.533 48 48c0 26.468-21.532 48-48 48z"></path></svg>\n      </a>\n    '),a+="\n    </div>\n  ",a},userView=e=>{let t=e.data(),a="bg-danger";t.online&&(t.active?(a="bg-success",t.idle&&(a="bg-orange-l")):a="bg-secondary");let n=`\n    <div class="d-flex align-items-center me-3">\n      <div class="position-relative me-3">\n        <img class="rounded-circle" src=${t.userImage} width="30" height="30" />\n\n        <span class="position-absolute d-inline-block top-0 right-0 ${a} rounded-circle" style="width: 7px; height: 7px;">\n        </span>\n      </div>\n\n      <div class="d-flex flex-column justify-content-between">\n        <div class="fw-bold text-muted">\n          ${t.userName?t.userName:"Anonymous"}\n        </div>\n  `;return t.active&&((t.userCity||t.userCountry)&&(n+='<div class="small text-muted location">',t.userCountry?(t.userCity&&(n+=`${t.userCity}, `),n+=t.userCountry):t.userCity&&(n+=t.userCity),t.idle&&(n+='\n          <span class="d-inline-block small fw-500 px-2 text-white bg-orange-l rounded-pill">\n            idle\n          </span>\n        '),n+="</div>"),(t.userDesignation||t.userComapny)&&(n+='<div class="small text-muted profession">',t.userComapny?(t.userDesignation&&(n+=`${t.userDesignation} at `),n+=t.userComapny):t.userDesignation&&(n+=t.userDesignation),n+="</div>")),n+="\n        </div>\n      </div>\n  ",t.userId?t.active&&(t.onCall?t.sender==user.fireId?n+=`\n            <button class="btn btn-sm bg-light rounded-circle c-ga xn" data-ga-category="Community Listing" data-ga-action="Call Phone Icon Click" data-ga-label="Event Listing" data-hash="${e.id}" data-user="${t.userId}">\n              <span data-bs-toggle="tooltip" title="Waiting for user ..." data-tooltip-check="true">\n                <svg class="svg-inline--fa fa-spinner-third fa-w-16 fa-lg fa-spin" aria-hidden="true" focusable="false" data-prefix="fad" data-icon="spinner-third" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" data-fa-i2svg=""><g class="fa-group"><path class="fa-secondary" fill="currentColor" d="M478.71 364.58zm-22 6.11l-27.83-15.9a15.92 15.92 0 0 1-6.94-19.2A184 184 0 1 1 256 72c5.89 0 11.71.29 17.46.83-.74-.07-1.48-.15-2.23-.21-8.49-.69-15.23-7.31-15.23-15.83v-32a16 16 0 0 1 15.34-16C266.24 8.46 261.18 8 256 8 119 8 8 119 8 256s111 248 248 248c98 0 182.42-56.95 222.71-139.42-4.13 7.86-14.23 10.55-22 6.11z"></path><path class="fa-primary" fill="currentColor" d="M271.23 72.62c-8.49-.69-15.23-7.31-15.23-15.83V24.73c0-9.11 7.67-16.78 16.77-16.17C401.92 17.18 504 124.67 504 256a246 246 0 0 1-25 108.24c-4 8.17-14.37 11-22.26 6.45l-27.84-15.9c-7.41-4.23-9.83-13.35-6.2-21.07A182.53 182.53 0 0 0 440 256c0-96.49-74.27-175.63-168.77-183.38z"></path></g></svg>\n              </span>\n            </button>\n          `:n+=`\n            <button class="btn btn-sm text-muted bg-light rounded-circle call-user c-ga xn" data-id="${t.userId}" data-name="${t.userName}" data-img="${t.userImage}" data-ga-category="Community Listing" data-ga-action="Call Phone Icon Click" data-ga-label="Event Listing" data-hash="${e.id}" data-user="${t.userId}" data-thank="true" data-online="${t.online}">\n              <span data-bs-toggle="tooltip" title="busy on another call" data-tooltip-check="true">\n                <svg class="svg-inline--fa fa-phone-alt fa-w-16" aria-hidden="true" focusable="false" data-prefix="fas" data-icon="phone-alt" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" data-fa-i2svg=""><path fill="currentColor" d="M497.39 361.8l-112-48a24 24 0 0 0-28 6.9l-49.6 60.6A370.66 370.66 0 0 1 130.6 204.11l60.6-49.6a23.94 23.94 0 0 0 6.9-28l-48-112A24.16 24.16 0 0 0 122.6.61l-104 24A24 24 0 0 0 0 48c0 256.5 207.9 464 464 464a24 24 0 0 0 23.4-18.6l24-104a24.29 24.29 0 0 0-14.01-27.6z"></path></svg>\n              </span>\n            </button>\n          `:n+=`\n          <button class="btn btn-sm ${t.onCall?"text-muted":""} bg-light rounded-circle call-user c-ga xn" data-id="${t.userId}" data-name="${t.userName}" data-img="${t.userImage}" data-ga-category="Community Listing" data-ga-action="Call Phone Icon Click" data-ga-label="Event Listing" data-hash="${e.id}" data-user="${t.userId}" data-thank="true" data-online="${t.online}">\n            <svg class="svg-inline--fa fa-phone-alt fa-w-16" aria-hidden="true" focusable="false" data-prefix="fas" data-icon="phone-alt" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" data-fa-i2svg=""><path fill="currentColor" d="M497.39 361.8l-112-48a24 24 0 0 0-28 6.9l-49.6 60.6A370.66 370.66 0 0 1 130.6 204.11l60.6-49.6a23.94 23.94 0 0 0 6.9-28l-48-112A24.16 24.16 0 0 0 122.6.61l-104 24A24 24 0 0 0 0 48c0 256.5 207.9 464 464 464a24 24 0 0 0 23.4-18.6l24-104a24.29 24.29 0 0 0-14.01-27.6z"></path></svg>\n          </button>\n        `):n+=`\n      <button class="btn btn-sm text-muted bg-light rounded-circle c-ga xn" data-ga-category="Community Listing" data-ga-action="Call Phone Icon Click" data-ga-label="Event Listing" data-hash="${e.id}" data-user="${t.userId}" data-thank="true">\n        <span data-bs-toggle="tooltip" title="Verification pending" data-tooltip-check="true">\n          <svg class="svg-inline--fa fa-phone-slash fa-w-20" aria-hidden="true" focusable="false" data-prefix="fas" data-icon="phone-slash" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512" data-fa-i2svg=""><path fill="currentColor" d="M268.2 381.4l-49.6-60.6c-6.8-8.3-18.2-11.1-28-6.9l-112 48c-10.7 4.6-16.5 16.1-13.9 27.5l24 104c2.5 10.8 12.1 18.6 23.4 18.6 100.7 0 193.7-32.4 269.7-86.9l-80-61.8c-10.9 6.5-22.1 12.7-33.6 18.1zm365.6 76.7L475.1 335.5C537.9 256.4 576 156.9 576 48c0-11.2-7.7-20.9-18.6-23.4l-104-24c-11.3-2.6-22.9 3.3-27.5 13.9l-48 112c-4.2 9.8-1.4 21.3 6.9 28l60.6 49.6c-12.2 26.1-27.9 50.3-46 72.8L45.5 3.4C38.5-2 28.5-.8 23 6.2L3.4 31.4c-5.4 7-4.2 17 2.8 22.4l588.4 454.7c7 5.4 17 4.2 22.5-2.8l19.6-25.3c5.4-6.8 4.1-16.9-2.9-22.3z"></path></svg>\n        </span>\n      </button>\n    `,n},addUserView=e=>`\n    <div id="${e.id}" class="d-flex justify-content-between align-items-center w-100 p-3 border-light border-top">\n      ${userView(e)}\n    </div>\n  `,changeUserView=e=>{let t=e.data();if(document.getElementById(e.id)&&!t.onCall&&document.getElementById(e.id).remove(),!t.online)return!1;if(t.onCall)document.getElementById(e.id)&&(document.getElementById(e.id).innerHTML=userView(e));else{let a=document.createElement("div");a.id=e.id,a.className="d-flex justify-content-between align-items-center w-100 p-3 border-light border-top",a.innerHTML=userView(e),t.userId?t.online?t.active?document.getElementById("user-online-active")&&document.getElementById("user-online-active").prepend(a):document.getElementById("user-online-inactive")&&document.getElementById("user-online-inactive").prepend(a):t.active?document.getElementById("user-offline-active")&&document.getElementById("user-offline-active").append(a):document.getElementById("user-offline-inactive")&&document.getElementById("user-offline-inactive").append(a):t.online?t.active?document.getElementById("nuser-online-active")&&document.getElementById("nuser-online-active").prepend(a):document.getElementById("nuser-online-inactive")&&document.getElementById("nuser-online-inactive").prepend(a):t.active?document.getElementById("nuser-offline-active")&&document.getElementById("nuser-offline-active").append(a):document.getElementById("nuser-offline-inactive")&&document.getElementById("nuser-offline-inactive").append(a)}setTimeout((()=>{let t=document.getElementById(e.id);if(t){let e=t.querySelector(".call-user");e&&bindCallUser(e)}getTooltip()}),300)},bindCurrentUserActive=()=>{let e=document.getElementById("current-user-active");e&&e.addEventListener("change",(async()=>{e.checked?addCustomGAevent({category:"Community Listing",action:"Call Active On",label:"Event Listing",interact:0}):addCustomGAevent({category:"Community Listing",action:"Call Active Off",label:"Event Listing",interact:0}),await firebase.firestore().collection("user").doc(user.fireId).update({active:e.checked})}));let t=document.getElementById("abort-live-call"),a=document.getElementById("join-live-call");t&&t.addEventListener("click",(async()=>{let e=document.getElementById("decline-live-call");e&&e.click(),firebase.firestore().collection("user").doc(user.fireId).update({onCall:!1,sender:null,receiver:null});let t=await firebase.firestore().collection("user").where("sender","==",user.fireId).get();t.size&&t.forEach((e=>{e.ref.update({onCall:!1,sender:null})}));let a=await firebase.firestore().collection("user").where("receiver","==",user.fireId).get();a.size&&a.forEach((e=>{e.ref.update({onCall:!1,receiver:null})}))})),a&&a.addEventListener("click",(async()=>{let e=document.getElementById("accept-live-call");e&&e.click();let t=await firebase.firestore().collection("user").where("sender","==",user.fireId).get();t.size&&t.forEach((e=>(attendRedirect({sender:user.fireId,receiver:e.id}),!1)));let a=await firebase.firestore().collection("user").where("receiver","==",user.fireId).get();a.size&&a.forEach((e=>(attendRedirect({sender:e.id,receiver:user.fireId}),!1)))}))},bindCallUser=e=>{e.addEventListener("click",(async()=>{if(getCookie("user")&&getCookie("user_token")){let t=e.dataset.hash;e.dataset.user,e.dataset.name;if("false"==e.dataset.online)return!1;let a=await firebase.firestore().collection("user").doc(user.fireId).get(),n=await firebase.firestore().collection("user").doc(t).get();a.data().onCall||n.data().onCall||(showToast("Connecting call..."),await firebase.firestore().collection("user").doc(user.fireId).update({onCall:!0,receiver:null}),await firebase.firestore().collection("user").doc(t).update({onCall:!0,sender:user.fireId}),setTimeout((async()=>{await firebase.firestore().collection("user").doc(user.fireId).update({onCall:!1,receiver:null}),await firebase.firestore().collection("user").doc(t).update({onCall:!1,sender:null}),showToast("call disconnnected...")}),36e5))}else signInTT()}))};var idle={set:null,hit:0},setIdle=null,hitIdle=0;const fireUserOffline=async()=>{setIdle&&(clearInterval(setIdle),setIdle=null),await firebase.firestore().collection("user").doc(user.fireId).update({online:!1,lastSeen:firebase.firestore.FieldValue.serverTimestamp()})},fireUserOnline=async()=>{setIdle&&(clearInterval(setIdle),setIdle=null),hitIdle=0,setIdle=setInterval((async()=>{0==hitIdle&&await firebase.firestore().collection("user").doc(user.fireId).update({idle:!0}),++hitIdle>5&&await fireUserOffline()}),3e5),await firebase.firestore().collection("user").doc(user.fireId).update({online:!0,idle:!1,category:live.category,lastActive:firebase.firestore.FieldValue.serverTimestamp()})},fireUserTrack=()=>{window.addEventListener("focus",(()=>{fireUserOnline()})),window.addEventListener("blur",(()=>{fireUserOffline()})),document.addEventListener("visibilitychange",(async()=>{"visible"===document.visibilityState?fireUserOnline():"hidden"===document.visibilityState&&fireUserOffline()})),["mousedown","mousemove","keydown","scroll","touchstart"].forEach((function(e){document.addEventListener(e,(function(){hitIdle>0&&fireUserOnline()}))}))},attendSender=async e=>{let t=await firebase.firestore().collection("user").doc(e.sender).get();if(t.exists){let a=t.data();if(a.online){document.getElementById("live-user-calling")&&document.getElementById("live-user-calling").remove();let t=document.createElement("div");t.id="live-user-calling",t.className=`position-fixed ${"phone"==device?"w-100":"w-25"} fw-500 p-3 text-muted bg-white rounded-3 collapse show`,t.style.bottom="phone"==device?"0px":"15px",t.style.right="phone"==device?"0px":"15px",t.style.boxShadow="0px -5px 5px 0px #cecece",t.style.zIndex="1002",t.innerHTML=`\n        <div class="d-flex justify-content-center align-items-center">\n          <img class="border rounded-circle me-3" src="${a.userImage}" width="70" height="70" alt="${a.userName}" />\n\n          <span class="fs-22 fw-bold">\n            ${a.userName}\n          </span>\n        </div>\n\n        <div class="text-center my-2">\n          Incoming Call\n        </div>\n\n        <div class="d-flex justify-content-center">\n          <button id="accept-live-call" class="btn text-muted px-3 rounded-pill me-3 c-ga xn" data-bs-toggle="collapse" data-bs-target="#live-user-calling" data-ga-category="Community Listing" data-ga-action="Call Join Click" data-ga-label="Event Listing" aria-expanded="true" aria-controls="#live-user-calling">\n            <img src="https://c1.10times.com/images/call_accept.gif" width="55" height="55" alt="accept call" />\n            <span>Accept</span>\n          </button>\n\n          <button id="decline-live-call" class="btn text-muted px-3 rounded-pill ms-3 c-ga xn" data-bs-toggle="collapse" data-bs-target="#live-user-calling" data-ga-category="Community Listing" data-ga-action="Call Ignore Click" data-ga-label="Event Listing" aria-expanded="true" aria-controls="#live-user-calling">\n            <img src="https://c1.10times.com/images/call_reject.png" width="55" height="55" alt="reject call" />\n            <span>Decline</span>\n          </button>\n        </div>\n\n        <div class="small text-center mt-2">\n          You will be redirected for video call\n        </div>\n      `,document.body.appendChild(t),setTimeout((()=>{let t=document.getElementById("accept-live-call"),a=document.getElementById("decline-live-call"),n=document.getElementById("live-user-calling");t&&t.addEventListener("click",(async()=>{setTimeout((()=>{n&&n.remove()}),500),await firebase.firestore().collection("user").doc(e.sender).update({receiver:user.fireId}),attendRedirect({sender:e.sender,receiver:user.fireId})})),a&&a.addEventListener("click",(()=>{setTimeout((()=>{n&&n.remove()}),500),firebase.firestore().collection("user").doc(e.sender).update({onCall:!1,receiver:null}),firebase.firestore().collection("user").doc(user.fireId).update({onCall:!1,sender:null})}));let i=document.getElementById("live-user-calling");if(i){let e=document.createElement("audio");e.id="ring-live-call",e.autoplay=!0,e.loop=!0,e.innerHTML='\n            <source src="https://c1.10times.com/audio/call_ring.mp3" type="audio/mp3" />\n          ',i.appendChild(e)}setTimeout((()=>{let e=document.getElementById("ring-live-call");e&&e.remove()}),6e3)}),1e3)}}},attendRedirect=e=>{request({method:"POST",url:"/ajax?for=user_hash"}).then((async t=>{let a=`${cat2event[live.category].floor}?hash=${JSON.parse(t)}`,n=null;e.sender&&e.sender==user.fireId&&(a+="&action=call_initiated",n=e.receiver),e.receiver&&e.receiver==user.fireId&&(a+="&action=call_accepted",n=e.sender);let i=await firebase.firestore().collection("user").doc(n).get();i.exists&&request({method:"POST",url:`/ajax?for=sender_receiver&receiver=${i.data().userId}`}).then((t=>{t=JSON.parse(t),a+=`&receiverid=${t.receiver}`,e.sender&&e.sender==user.fireId&&setCookie("onCall",e.receiver,60),e.receiver&&e.receiver==user.fireId&&setCookie("onCall",e.sender,60),open(a,"_target")}))}))},onlineUsers=async()=>{let e=new Date;live.total=0,live.inactive=0,await firebase.firestore().collection("user").doc(user.fireId).update({online:!0,idle:!1,lastActive:firebase.firestore.FieldValue.serverTimestamp()}),firebase.firestore().collection("user").where("category","==",live.category).where("online","==",!0).onSnapshot((t=>{t.docChanges().forEach((t=>{let a=t.doc,n=a.data();if(user.id&&n.userId&&a.id!=user.fireId&&n.userId==user.id)return!1;if(n.lastSeen){let t=new Date(n.lastSeen);if(Math.ceil(Math.abs(e-t)/864e5)>3)return live.inactive++,!1}if(void 0!==live.stats[a.id])live.stats[a.id]=n.online,changeUserView(a);else if(n.category==live.category)if("added"===t.type)if(a.id==user.fireId){let e=document.getElementById("live-user-current");e&&(e.innerHTML=addCurrentUser(a.data()),setTimeout((()=>{bindCurrentUserActive()}),300))}else n.online&&(live.stats[a.id]=n.online,changeUserView(a));else if("modified"===t.type)if(a.id==user.fireId){let e=document.getElementById("live-user-current");if(e&&(e.innerHTML=addCurrentUser(a.data()),setTimeout((()=>{bindCurrentUserActive()}),300)),n.onCall){if(getCookie("onCall")){if(n.sender||n.receiver)return!1;deleteCookie("onCall")}n.sender?attendSender(n):n.receiver&&attendRedirect({sender:user.fireId,receiver:n.receiver})}else if(getCookie("onCall"))deleteCookie("onCall");else{let e=document.getElementById("live-user-calling");e&&e.remove()}}else n.online!=live.stats[a.id]&&(live.stats[a.id]=n.online,changeUserView(a));else"removed"===t.type&&(document.getElementById(a.id)&&document.getElementById(a.id).remove(),null!=live.stats[a.id]&&delete live.stats[a.id])})),live.users=Object.values(live.stats).filter((e=>e)).length,document.getElementById("live-user-count").innerHTML=`${live.users} ${live.users>1?"members":"member"}`;let a=document.getElementById("make-call");if(a)if(live.users>0){if("flex"!=a.style.display){let e=document.createElement("audio");e.id="show-make-call",e.autoplay=!0,e.innerHTML='\n            <source src="https://c1.10times.com/audio/call_live.mp3" type="audio/mp3" />\n          ',a.appendChild(e),a.style.display="flex",a.classList.add("bounce"),setTimeout((()=>{let e=document.getElementById("make-call");e&&e.classList.remove("bounce")}),2e3),setTimeout((()=>{let e=document.getElementById("show-make-call");e&&e.remove()}),4500),addCustomGAevent({category:"Community Listing",action:"Call Bubble Appeared",label:"Event Listing",interact:0})}}else"none"!=a.style.display&&(a.style.display="none")})),await firebase.database().ref(".info/connected").on("value",(async e=>{if(0==e.val())return setIdle&&(clearInterval(setIdle),setIdle=null),await firebase.firestore().collection("user").doc(user.fireId).update({onCall:!1,online:!1,sender:null,receiver:null}),!1;await firebase.database().ref("/status/user/"+user.fireId).onDisconnect().update({onCall:!1,online:!1,sender:null,receiver:null,lastSeen:firebase.database.ServerValue.TIMESTAMP}),fireUserOnline()})),window.addEventListener("focus",(()=>{fireUserOnline()})),window.addEventListener("blur",(()=>{fireUserOffline()})),document.addEventListener("visibilitychange",(async()=>{"visible"===document.visibilityState?fireUserOnline():"hidden"===document.visibilityState&&fireUserOffline()})),["mousedown","mousemove","keydown","scroll","touchstart"].forEach((function(e){document.addEventListener(e,(function(){hitIdle>0&&fireUserOnline()}))}))},liveUserView=()=>{document.getElementById("call-view")&&document.getElementById("call-view").remove();let e=document.createElement("div");e.id="call-view",e.className=`position-fixed ${"phone"==device?"w-100":"w-25 rounded-3"} bg-white shadow collapse`,e.style.right="phone"==device?"0px":"15px",e.style.bottom="phone"==device?"0px":"15px",e.style.zIndex="1001",e.innerHTML=`\n    <div id="live-user-current" class="text-white p-3 bg-orange-l ${"phone"==device?"rounded-bottom-full":"rounded-3 rounded-bottom-full"}">\n    </div>\n    \n    <div id="live-user-header" class="p-3">\n      <small class="fw-bold">\n        Live Members\n      </small>\n      \n      <br/>\n\n      <small class="text-muted">\n        In ${live.category_name} Community\n      </small>\n\n      <br/>\n    </div>\n    \n    <div id="live-user-list" class="scroll" style="min-height: 25vh; max-height: 40vh;">\n      <div id="user-online-active">\n      </div>\n      \n      <div id="nuser-online-active">\n      </div>\n\n      <div id="user-online-inactive">\n      </div>\n\n      <div id="nuser-online-inactive">\n      </div>\n\n      <div id="user-offline-active">\n      </div>\n\n      <div id="nuser-offline-active">\n      </div>\n\n      <div id="user-offline-inactive">\n      </div>\n\n      <div id="nuser-offline-inactive">\n      </div>\n    </div>\n  `,document.body.appendChild(e)},addVideoCallButton=()=>{document.getElementById("make-call")&&document.getElementById("make-call").remove();let e=document.createElement("button");e.id="make-call",e.className="position-fixed btn btn-lg bg-orange-l text-white fs-18 fw-normal justify-content-between align-items-center rounded-pill collapsed c-ga",e.style.display="none",e.style.right="phone"==device?"5px":"15px",e.style.bottom="phone"==device?"60px":"15px",e.style.zIndex="999",e.dataset.bsToggle="collapse",e.dataset.bsTarget="#call-view",e.dataset.gaCategory="Community Listing",e.dataset.gaAction="Call Bubble Open",e.dataset.gaLabel="Event Listing",e.ariaExpanded="false",e.innerHTML='\n    <small class="text-white bg-success px-1 rounded-3 me-3">\n      Live\n    </small>\n\n    <span class="text-white text-nopwrap me-3">\n      <span id="live-user-count">\n        0 Member\n      </span>\n    </span>\n\n    <svg class="svg-inline--fa fa-phone-alt fa-w-16 fa-sm" aria-hidden="true" focusable="false" data-prefix="fas" data-icon="phone-alt" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" data-fa-i2svg=""><path fill="currentColor" d="M497.39 361.8l-112-48a24 24 0 0 0-28 6.9l-49.6 60.6A370.66 370.66 0 0 1 130.6 204.11l60.6-49.6a23.94 23.94 0 0 0 6.9-28l-48-112A24.16 24.16 0 0 0 122.6.61l-104 24A24 24 0 0 0 0 48c0 256.5 207.9 464 464 464a24 24 0 0 0 23.4-18.6l24-104a24.29 24.29 0 0 0-14.01-27.6z"></path></svg>\n  ',document.body.appendChild(e),setTimeout((()=>{document.getElementById("make-call")&&document.getElementById("make-call").addEventListener("click",(()=>{live.users>5?addCustomGAevent({category:"Community Listing",action:"Call Users 5+",label:"Event Listing",interact:0}):addCustomGAevent({category:"Community Listing",action:"Call Users 5-",label:"Event Listing",interact:0})}))}),300)},updateFireUser=async e=>{if(!e.category||!e.categoryName)return page.category&&1==page.is_group&&[19,27,156].indexOf(parseInt(page.category))>-1&&(localLog({type:"Fire User",info:"adding user"}),await addFireUser()),!1;let t=!1,a={};!user.gaId||e.gaId&&e.gaId==user.gaId||(a.gaId=user.gaId,t=!0),!user.id||e.userId&&e.userId==user.id||(a.userId=user.id,t=!0),!user.name||e.userName&&e.userName==user.name||(a.userName=user.name,t=!0),user.image&&user.image.indexOf("no-pic")<0&&(!e.userImage||e.userImage!=user.image)&&(a.userImage=user.image,t=!0),!user.city||!user.city.name||e.userCity&&e.userCity==user.city.name||(a.userCity=user.city.name,t=!0),!user.country||!user.country.name||e.userCountry&&e.userCountry==user.country.name||(a.userCountry=user.country.name,t=!0),!user.designation||e.userDesignation&&e.userDesignation==user.designation||(a.userDesignation=user.designation,t=!0),!user.company||!user.company.name||e.userCompany&&e.userCompany==user.company.name||(a.userCompany=user.company.name,t=!0),t&&await firebase.firestore().collection("user").doc(user.fireId).update(a),localLog({type:"Fire User",info:"user updated"}),live.category=e.category,live.category_name=e.categoryName,addVideoCallButton(),liveUserView(),onlineUsers()},addFireUser=async()=>{let e={gaId:user.gaId,userId:user.id||null,userName:user.name||"Anonymous",userImage:user.image||"",userCity:user.city&&user.city.name||null,userCountry:user.country&&user.country.name||null,userDesignation:user.designation||null,userCompany:user.company&&user.company.name||null,active:!0,idle:!1,onCall:!1,online:!0,category:parseInt(page.category),categoryName:page.category_name,sender:null,receiver:null,created:firebase.firestore.FieldValue.serverTimestamp()};await firebase.firestore().collection("user").doc(user.fireId).set(e),localLog({type:"Fire User",info:"user added"}),live.category=parseInt(page.category),live.category_name=page.category_name,addVideoCallButton(),liveUserView(),onlineUsers()},initLiveUsers=async()=>{let e=await firebase.firestore().collection("user").doc(user.fireId).get();e.exists?(localLog({type:"Fire User",info:"updating user"}),updateFireUser(e.data())):page.category&&1==page.is_group&&[19,27,156].indexOf(parseInt(page.category))>-1&&(localLog({type:"Fire User",info:"adding user"}),addFireUser())},updateLastActive=async()=>{await updateFCM({action:"update",actor:"launch",data:{click_action:location.pathname}}),localLog({type:"WEB",info:"Last Active Updated"})},updateFCM=async(e={})=>{if(!e.action||!e.actor)return!1;e.data||(e.data=[]),await request({method:"POST",url:`/fcm?action=${e.action}&${e.action}=${e.actor}`,data:e.data}),"update"==e.action&&"device"==e.actor&&dataLayer[0]["Page Type"]&&["Event Listing","Event Detail"].includes(dataLayer[0]["Page Type"].split(" | ")[0])&&updateLastActive()},getFCMUser=async(e={})=>{let t=getCookie("_ga");t&&(t=t.replace(/GA1.1.|GA1.2./i,""));let a=await request({method:"POST",url:"/fcm?action=read&read=device"}),n=JSON.parse(a);if(!n[0]||n.message&&"No data available"==n.message)return deleteCookie("fcm_token"),getFCMtoken({callback:e.callback,callbackParam:e.callbackParam}),!1;if(n=n[0],n.device&&setCookie("fcm_device",n.device),t&&t!=n.gaId||user.id&&user.id!=n.userId||e.token&&e.token!=n.token||n.unsubscribe){await updateFCM({action:"update",actor:"device"});let a="";return t&&t!=n.gaId&&(a+=`\ngaId: ${n.gaId} -> ${t} `),e.token&&e.token!=n.token&&(a+=`\ntoken: ${n.token} -> ${e.token} `),user.id&&user.id!=n.userId&&(a+=`\nuser: ${n.userId} -> ${user.id} `),n.unsubscribe&&(a+="\nunsubscribe: true -> false "),localLog({type:"FCM",info:`Data Updated: ${e.token} ${a}`}),handleCallback(e)}return e.token&&localLog({type:"FCM",info:`Token Available \n${e.token}`}),handleCallback(e)},getFCMtoken=async(e={})=>{let t=await firebase.messaging().getToken({vapidKey:"BIQAVRKDMzJ5UGvA2vch-RkptU1_nsCsOv10xy0C_L3NGzjy5HyrJTjvBsGLgCBHdlLDW_diRtGCaTBKaiIleks"});if(t){let a=getCookie("fcm_token");if(a&&a==t)return await getFCMUser({token:t,callback:e.callback,callbackParam:e.callbackParam}),!1;setCookie("fcm_token",t,1440),await updateFCM({action:"update",actor:"device"}),localLog({type:"FCM",info:`Token Updated \n${t}`}),handleCallback(e)}},initFCM=async()=>{navigator.serviceWorker&&(await getPushPermission(),"granted"===Notification.permission&&("PushManager"in window?getFCMtoken():localLog({type:"Notification",info:"Web Push isn't supported"})))};(async()=>{(await initFirebase(),setTimeout(initFCM,2e4),"phone"!=device)&&firebase.database().ref(".info/connected").on("value",(async e=>{if(!0===e.val()&&(localLog({type:"Fire User",info:"connected"}),await initLiveUsers(),!getCookie("user")||!getCookie("user_token"))){let e=setInterval((async()=>{getCookie("user")&&getCookie("user_token")&&(clearInterval(e),page.category&&1==page.is_group&&[19,27,156].indexOf(parseInt(page.category))>-1&&initLiveUsers())}),300)}}))})();